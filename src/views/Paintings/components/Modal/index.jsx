import { Fragment, useEffect, useRef } from "react";
import { Dialog, DialogPanel, DialogTitle, Transition, TransitionChild } from "@headlessui/react";
import Paintings from "@/views/Paintings";

const Modal = ({ selectedPainting, popupRef, isPopupOpen, setIsPopupOpen, handleClosePopup, dialogPanelRef }) => {
	Modal.propTypes = Paintings.propTypes;
	popupRef = useRef(null);
	dialogPanelRef = useRef(null);

	function HandleClickOutside(ref, childRef) {
		useEffect(() => {
			function handleClickOutside(event) {
				// dont close when clicking childRef
				if (ref.current && !ref.current.contains(event.target) && !childRef.current.contains(event.target)) {
					setIsPopupOpen(false);
				}
			}
			document.addEventListener("mousedown", handleClickOutside);
			return () => {
				document.removeEventListener("mousedown", handleClickOutside);
			};
		}, [ref, childRef]);
	}
	HandleClickOutside(popupRef, dialogPanelRef);

	return (
		<Transition appear enter="ease-out duration-300" enterFrom="opacity-0" enterTo="opacity-100" leave="ease-in duration-200" leaveFrom="opacity-100" leaveTo="opacity-0" as={Fragment} show={isPopupOpen} onClose={() => setIsPopupOpen(false)}>
			<Dialog as="div" className="relative z-10" onClose={() => {}}>
				<TransitionChild as={Fragment} enter="ease-out duration-300" enterFrom="opacity-0" enterTo="opacity-100" leave="ease-in duration-200" leaveFrom="opacity-100" leaveTo="opacity-0">
					<div className="fixed inset-0 bg-slate-400/80 backdrop-blur-lg transition-all" ref={popupRef} />
				</TransitionChild>

				<DialogPanel className="fixed inset-0 z-10 overflow-y-auto p-4 sm:p-6 md:p-20">
					<TransitionChild as={Fragment} enter="ease-out duration-300" enterFrom="opacity-0 scale-95 blur-lg" enterTo="opacity-100 scale-100" leave="ease-in duration-200" leaveFrom="opacity-100 scale-100" leaveTo="opacity-0 scale-95 blur-none">
						<div ref={dialogPanelRef} className="relative flex-col sm:flex-row flex p-8 bg-white rounded-3xl shadow-lg max-w-7xl mx-auto gap-4" onClick={(e) => e.stopPropagation()}>
							<img src={`/src/assets/paintings/${selectedPainting.image}`} alt={selectedPainting.name} className="aspect-square max-w-lg rounded-md lg:h-[700px] object-contain pointer-events-none" />
							<div className="flex flex-col gap-6 text-slate-900">
								{" "}
								<div className="flex items-center self-start gap-2">
									<DialogTitle as="h2" className="text-4xl font-semibold not-italic font-sans text-center">
										{selectedPainting.name}
									</DialogTitle>
									<dl>
										<dd className="text-base text-gray-300">({selectedPainting.date})</dd>
									</dl>
								</div>
								<dl className="flex gap-4 items-center text-sm">
									<dt className="uppercase font-semibold tracking-wide">Original-Kunstwerk (One of a Kind)</dt>
									<dd className="">Malerei, Öl auf Leinwand</dd>
								</dl>
								<dl className="flex gap-4 items-center text-sm">
									<dt className="uppercase  font-semibold tracking-wide">
										Ma<span className="lowercase">ß</span>e
									</dt>
									<dd className="">{selectedPainting.size.toLowerCase()}</dd>
								</dl>
								<dl className="flex gap-4 items-center text-sm">
									<dt className="uppercase  font-semibold tracking-wide">Rahmen</dt>
									<dd className="">nicht Gerahmt</dd>
								</dl>
								<dl className="flex gap-4 items-center text-sm">
									<dt className="uppercase  font-semibold tracking-wide">Kategorien</dt>
									<dd className=" flex gap-1">
										<label className="px-2.5 py-1 text-slate-500 bg-slate-100 rounded-lg">Figurative</label>
										<label className="px-2.5 py-1 text-slate-500 bg-slate-100 rounded-lg">Wald</label>
									</dd>
								</dl>
								<button className="flex hover:bg-slate-400/10 gap-1 px-5 py-2 bg-white shadow-md ring-2 ring-slate-400/10 rounded-lg w-fit font-semibold font-sans mt-4">
									Kaufen auf
									<svg width="98" height="24" viewBox="0 0 98 24" fill="none" xmlns="http://www.w3.org/2000/svg">
										<path
											d="M64.6561 1.40405C64.1761 1.70405 63.7081 2.65205 63.6361 3.46805C63.5641 4.24805 63.8641 5.48405 64.1401 5.60405C65.0641 5.95205 66.6721 4.38005 67.0801 2.73605C67.2001 2.25605 67.2001 2.11205 67.0441 1.88405C66.6361 1.24805 65.3281 0.996052 64.6561 1.40405Z"
											fill="#0A0D14"
											style={{
												fill: "#0A0D14",
												fillColor: "color(display-p3 0.0392 0.0510 0.0784)",
												fillOpacity: 1,
											}}
										/>
										<path
											d="M10.8601 2.13599C8.94007 2.80799 7.02007 5.08799 5.61607 8.35199L5.30407 9.08399L4.48807 9.28799C3.43207 9.55199 2.49607 9.99599 1.98007 10.488C1.54807 10.908 1.42807 11.364 1.74007 11.472C1.83607 11.508 2.49607 11.46 3.20407 11.364C3.91207 11.268 4.51207 11.196 4.53607 11.22C4.54807 11.232 4.42807 11.808 4.27207 12.492C3.64807 15.072 3.58807 16.812 4.09207 17.448C4.41607 17.856 5.11207 17.868 5.94007 17.472C6.94807 17.004 6.99607 16.896 7.11607 15.024C7.17607 14.124 7.28407 12.84 7.36807 12.18L7.50007 10.98L9.66007 11.028C10.8481 11.052 11.8441 11.088 11.8561 11.112C11.8801 11.124 11.7001 11.94 11.4601 12.9C10.9681 14.844 10.9321 15.888 11.3281 16.656C11.6761 17.328 12.1561 17.532 13.2721 17.496C14.0881 17.46 14.3521 17.4 15.0481 17.052C15.4921 16.824 16.1761 16.32 16.5721 15.948L17.2801 15.264V15.948C17.2801 17.376 17.6881 17.964 18.5641 17.808C19.1881 17.7 19.6441 17.448 19.8721 17.088C20.0521 16.836 20.0641 16.572 19.9921 15.24C19.9201 13.932 19.9441 13.524 20.1721 12.456C20.3041 11.784 20.4601 11.184 20.4961 11.148C20.5441 11.1 20.9641 11.04 21.4441 11.004L22.2961 10.932L22.0201 11.616C21.6241 12.612 21.4441 13.596 21.4321 14.82C21.4201 15.732 21.4681 15.996 21.7081 16.476C22.0921 17.256 22.5361 17.52 23.4601 17.52C24.6001 17.508 25.6081 16.956 26.4001 15.912C26.8561 15.3 27.0001 15.228 27.0001 15.624C27.0121 16.08 27.4201 16.848 27.8521 17.208C28.2121 17.52 28.3081 17.544 29.0521 17.496C30.1441 17.436 31.5961 16.728 32.5561 15.768L33.2401 15.084V15.852C33.2401 16.86 33.4201 17.472 33.7921 17.712C34.0681 17.892 34.1281 17.892 34.6561 17.7C35.4121 17.412 36.0841 16.98 36.2401 16.668C36.3481 16.476 36.3361 16.224 36.1681 15.564C36.0481 15.084 35.9401 14.316 35.9401 13.86C35.9401 13.116 36.0001 12.9 36.4441 11.976C37.0081 10.788 37.8001 9.83999 38.2321 9.83999C38.7721 9.83999 38.9161 10.152 38.8321 11.148C38.7961 11.652 38.7241 13.14 38.6881 14.46C38.6161 16.464 38.6401 16.932 38.7961 17.292C39.0721 17.964 39.4561 18 40.5601 17.436C41.6521 16.884 41.7721 16.656 41.5201 15.564C41.1961 14.208 41.2681 13.5 41.8441 12.336C42.5761 10.872 43.2601 10.332 43.9321 10.68C44.2201 10.836 44.2321 11.616 43.9801 13.08C43.7641 14.28 43.7521 15.708 43.9321 16.368C44.0041 16.632 44.2201 17.004 44.4121 17.196C44.7481 17.532 44.8081 17.544 45.5761 17.496C46.5481 17.448 47.4241 17.04 48.2641 16.272L48.8281 15.756L49.1761 16.332C49.7041 17.16 50.4241 17.544 51.6001 17.616C52.1281 17.64 52.8001 17.604 53.1361 17.52C53.8561 17.352 54.7681 16.74 55.2241 16.128C55.5121 15.744 55.5601 15.708 55.6321 15.912C55.8721 16.656 55.9921 16.896 56.2561 17.196C56.5201 17.472 56.6521 17.52 57.2401 17.52C58.0201 17.52 59.3041 16.968 60.0481 16.32C60.2881 16.104 60.5041 15.948 60.5281 15.972C60.5521 15.996 60.5161 16.308 60.4561 16.656L60.3241 17.28L58.9321 17.724C56.5081 18.468 55.5601 19.008 55.1281 19.824C54.6241 20.796 55.3681 22.236 56.6761 22.8C57.5401 23.184 58.8121 23.256 59.6881 22.98C61.0081 22.56 61.7041 21.648 62.4481 19.368L62.7721 18.396L63.8641 17.748C64.4641 17.388 65.3161 16.764 65.7601 16.356L66.5641 15.612L66.9121 16.14C67.7401 17.472 69.4321 17.916 71.8081 17.46C72.8881 17.256 73.6201 16.956 74.4241 16.368C74.7601 16.14 75.0361 15.96 75.0481 15.984C75.0601 16.008 75.1441 16.176 75.2401 16.368C75.5161 16.908 76.3321 17.364 77.3161 17.532C78.8041 17.784 79.9561 17.364 80.7481 16.296L81.0841 15.84L81.2401 16.38C81.5041 17.328 81.9361 17.616 82.9801 17.532C83.4241 17.484 85.4881 16.392 86.0161 15.912L86.5201 15.444V16.032C86.5201 17.376 86.9521 17.964 87.8041 17.808C88.4281 17.7 88.8841 17.448 89.1121 17.088C89.2921 16.836 89.3041 16.572 89.2321 15.24C89.1601 13.932 89.1841 13.524 89.4121 12.456C89.5441 11.784 89.7001 11.184 89.7361 11.148C89.7841 11.1 90.2041 11.04 90.6841 11.004L91.5361 10.932L91.2601 11.616C90.8641 12.612 90.6841 13.596 90.6721 14.82C90.6601 15.732 90.7081 15.996 90.9481 16.476C91.3201 17.256 91.7761 17.52 92.7001 17.52C93.6481 17.52 94.5001 17.112 95.2801 16.308C96.1321 15.42 96.5401 14.532 96.5401 13.572C96.5401 13.056 96.4921 12.78 96.3841 12.744C96.3001 12.72 95.7001 13.212 95.0641 13.836C92.9161 15.924 92.7601 15.78 93.6481 12.528C93.9361 11.484 94.2001 10.476 94.2481 10.308C94.3441 9.85199 93.6841 8.54399 93.2881 8.44799C93.1081 8.39999 92.6881 8.50799 92.1121 8.74799C91.5601 8.97599 91.0081 9.11999 90.6841 9.11999H90.1441L89.7361 8.31599C89.2441 7.31999 88.7761 6.96 87.9601 6.96C86.6281 6.96 86.1961 8.30399 87.1681 9.43199L87.5641 9.88799L87.2881 10.5C87.1321 10.824 86.9161 11.496 86.8081 11.976C86.6161 12.828 86.5801 12.876 85.6081 13.86C84.6001 14.868 83.9761 15.312 83.7601 15.18C83.5441 15.048 83.6401 14.028 84.0121 12.18C84.4801 9.85199 84.6001 8.17199 84.3121 7.73999C84.1561 7.49999 84.0241 7.43999 83.6041 7.43999C82.8841 7.43999 82.2121 7.65599 81.8881 7.97999C81.6121 8.25599 81.6001 8.35199 81.6001 9.69599C81.6001 11.316 81.3481 12.516 80.7481 13.8C80.1841 15.024 79.5481 15.54 78.8041 15.396C77.9881 15.24 77.9641 14.556 78.6721 11.796C79.2601 9.50399 79.2121 7.89599 78.5401 7.63199C78.0001 7.42799 76.2001 7.72799 76.2001 8.02799C76.2001 8.06399 76.0681 9.20399 75.9001 10.56L75.6121 13.02L74.8561 13.716C73.4041 15.048 71.6881 15.564 70.3681 15.06C69.7201 14.808 69.4801 14.496 69.4801 13.848C69.4801 13.296 69.4441 13.32 71.3161 12.612C73.0681 11.952 73.9081 11.268 74.1721 10.296C74.4241 9.33599 74.1601 8.55599 73.3921 7.99199C73.1041 7.77599 72.8881 7.73999 71.8441 7.73999C70.7401 7.73999 70.5481 7.77599 69.9001 8.08799C68.3881 8.83199 67.0921 10.608 66.6241 12.588C66.4321 13.44 66.3961 13.488 65.5801 14.208C64.5001 15.168 63.7201 15.768 63.6601 15.696C63.6241 15.672 63.7441 15.156 63.9121 14.568C64.4521 12.72 65.0401 10.044 65.0401 9.44399C65.0401 8.80799 64.7521 8.14799 64.2601 7.65599C63.5641 6.96 63.0241 7.116 62.6401 8.12399C62.3281 8.97599 61.4641 11.796 61.3681 12.324C61.2841 12.744 59.7361 14.328 58.8121 14.952C58.3321 15.264 58.2961 15.264 58.1041 15.072C57.9241 14.904 57.9001 14.604 57.9001 12.924V10.98L58.3561 10.188C58.5961 9.75599 58.8001 9.27599 58.8001 9.11999C58.8001 8.42399 57.8881 7.55999 57.0601 7.46399C56.6401 7.42799 56.5201 7.45199 56.3761 7.66799C56.2081 7.90799 56.1481 7.91999 55.6201 7.78799C55.2841 7.70399 54.6721 7.66799 54.0961 7.71599C53.3161 7.76399 52.9681 7.85999 52.2721 8.20799C50.6281 9.01199 49.3561 10.656 48.8881 12.54C48.7081 13.272 48.6001 13.464 48.0121 14.076C47.2681 14.844 46.6321 15.3 46.4401 15.18C46.2601 15.072 46.2961 14.688 46.6201 13.44C46.9921 12.024 47.1721 10.512 47.0401 9.92399C46.8001 8.81999 45.9961 8.33999 44.5921 8.42399C43.6321 8.48399 42.9721 8.77199 42.2521 9.41999L41.7961 9.83999L41.7121 9.37199C41.5681 8.42399 40.5721 7.67999 39.4801 7.67999C38.7241 7.67999 38.2081 7.89599 37.5961 8.44799L37.1161 8.87999L36.9001 8.38799C36.6841 7.91999 35.9881 7.19999 35.7481 7.19999C34.8721 7.19999 33.5881 9.77999 33.4081 11.928C33.3361 12.768 33.3241 12.792 32.6521 13.476C31.9801 14.184 30.6961 15.036 30.0961 15.18C29.8441 15.24 29.7481 15.204 29.6281 14.976C29.3641 14.496 29.4841 11.46 29.8321 9.68399L29.9041 9.35999L31.0081 9.43199L32.1121 9.51599L32.2561 9.17999C32.3401 8.99999 32.4361 8.61599 32.4841 8.33999L32.5441 7.83599L31.9081 7.76399C31.5481 7.71599 31.0321 7.67999 30.7561 7.67999H30.2521L30.6721 6.96C31.0681 6.28799 31.0801 6.21599 30.9601 5.748C30.7801 5.11199 30.2521 4.55999 29.8081 4.55999C29.3041 4.55999 28.6441 5.33999 28.2121 6.46799C28.0081 6.99599 27.8401 7.47599 27.8401 7.53599C27.8401 7.65599 27.2761 7.79999 26.8081 7.79999C26.4481 7.79999 26.1601 8.32799 26.1601 8.99999V9.47999H26.7121C27.2521 9.47999 27.2641 9.49199 27.2041 9.80399C27.1561 9.99599 27.0361 10.764 26.9281 11.52L26.7361 12.9L25.7521 13.896C24.7801 14.904 24.2161 15.312 24.0001 15.18C23.7841 15.048 23.8801 14.472 24.4081 12.528C24.6961 11.484 24.9601 10.476 25.0081 10.308C25.1041 9.85199 24.4441 8.54399 24.0481 8.44799C23.8681 8.39999 23.4481 8.50799 22.8721 8.74799C22.3201 8.97599 21.7681 9.11999 21.4441 9.11999H20.9041L20.4961 8.31599C20.0041 7.31999 19.5361 6.96 18.7201 6.96C17.3761 6.96 16.9561 8.30399 17.9281 9.43199L18.3361 9.89999L18.0961 10.356C17.9761 10.608 17.7601 11.232 17.6281 11.736C17.4001 12.636 17.3641 12.696 16.3561 13.704C15.1921 14.88 14.3881 15.396 14.1361 15.144C14.0401 15.048 13.9801 14.676 13.9801 14.184C13.9801 13.488 14.0881 13.104 14.7481 11.34C15.8761 8.32799 16.1041 7.31999 16.0561 5.7C16.0201 4.55999 15.9601 4.29599 15.6961 3.76799C15.2761 2.95199 14.5561 2.33999 13.7881 2.11199C12.9601 1.85999 11.6161 1.87199 10.8601 2.13599ZM12.4681 4.85999C13.1641 5.20799 13.3321 6.50399 12.9001 8.12399L12.6721 8.99999H10.9921C10.0561 8.99999 9.01207 8.96399 8.66407 8.91599C8.04007 8.84399 8.01607 8.83199 8.08807 8.50799C8.19607 7.95599 8.86807 6.63599 9.36007 6.012C10.2481 4.884 11.5801 4.39199 12.4681 4.85999ZM55.7521 9.43199C55.6081 9.98399 55.4521 11.448 55.4401 12.192C55.4401 13.152 55.1641 13.908 54.6001 14.556C53.7361 15.54 52.7041 15.768 52.0681 15.132C51.7081 14.772 51.6721 14.568 51.7201 13.332C51.7801 11.712 53.1961 9.93599 54.9241 9.29999C55.6561 9.03599 55.8361 9.05999 55.7521 9.43199ZM71.6521 9.76799C71.8681 10.224 71.5081 10.728 70.5481 11.352C70.0801 11.652 69.6721 11.868 69.6361 11.832C69.4921 11.7 70.0921 10.104 70.3921 9.80399C70.8241 9.37199 71.4721 9.35999 71.6521 9.76799ZM59.4001 20.46C58.9561 21.396 58.6201 21.66 57.9961 21.564C57.0961 21.42 56.5681 20.688 57.1321 20.388C57.6361 20.124 59.7001 19.476 59.7361 19.572C59.7601 19.632 59.6041 20.028 59.4001 20.46Z"
											fill="#0A0D14"
											style={{
												fill: "#0A0D14",
												fillColor: "color(display-p3 0.0392 0.0510 0.0784)",
												fillOpacity: 1,
											}}
										/>
									</svg>
								</button>
							</div>
							<button className="absolute bg-white opacity-50 hover:opacity-100 hover:shdow-xl transition-all duration-300 ease-in-out ring-2 ring-gray-500/10 p-2.5 rounded-full shadow-md top-4 right-4" onClick={handleClosePopup}>
								<svg xmlns="http://www.w3.org/2000/svg" className="size-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
									<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
								</svg>
							</button>
						</div>
					</TransitionChild>
				</DialogPanel>
			</Dialog>
		</Transition>
	);
};

export default Modal;
